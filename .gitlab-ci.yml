image: ubuntu:xenial
before_script:
  - .ci/install_common_dependencies.sh
  - rm -rf ChibiOS
  - git submodule update --init --recursive

firmware_tests:
  stage: test
  script:
    - .ci/install_cpputest.sh
    - packager
    - make protoc
    - mkdir -p build && cd build
    - cmake ..
    - make check

firmware_build:
  stage: test
  script:
    - .ci/install_crosscompiler.sh
    - packager
    - make protoc
    - make
